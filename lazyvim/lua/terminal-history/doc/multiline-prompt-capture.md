# –ú–µ—Ö–∞–Ω–∏–∑–º –∑–∞—Ö–≤–∞—Ç–∞ –∫–æ–º–∞–Ω–¥ –≤ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–º –ø—Ä–æ–º–ø—Ç–µ

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

### –ù–∞—á–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞)
```
0: user@hostname ~/dotfiles/lazyvim (main)
1: ‚ùØ
```

### –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞
```
0: ‚ùØ pwd
1: /Users/romodanov.d/dotfiles/lazyvim
2: user@hostname ~/dotfiles/lazyvim (main)
3: ‚ùØ
```

## üîç –ê–ª–≥–æ—Ä–∏—Ç–º –¥–µ—Ç–µ–∫—Ü–∏–∏ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞

### 1. –î–µ—Ç–µ–∫—Ü–∏—è –ø—Ä–æ–º–ø—Ç–∞ (capture-lines.lua:39-83)

```lua
local prompt_symbols = { "^‚ûú%s*$", "^‚ùØ%s*$", "^‚ñ∂%s*$", "^Œª%s*$" }

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Å–∏–º–≤–æ–ª –ø—Ä–æ–º–ø—Ç–∞
if line:match(pattern) then
  is_prompt_symbol = true
end

-- –ï—Å–ª–∏ —ç—Ç–æ —Å–∏–º–≤–æ–ª –ø—Ä–æ–º–ø—Ç–∞, –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–æ–∫—É
if is_prompt_symbol and index > 1 then
  local prev_line = lines[index - 1]

  -- –ü—Ä–∏–∑–Ω–∞–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏
  local is_info_line = prev_line:match("[~/]") -- –ø—É—Ç—å
    or prev_line:match("[‚á°‚á£¬±]") -- git —Å–∏–º–≤–æ–ª—ã
    or prev_line:match("master") -- git branch
    or prev_line:match("main") -- git branch
    or prev_line:match("%d+:%d+") -- –≤—Ä–µ–º—è
```

### 2. –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—Ç—Ä–æ–∫ –ø—Ä–æ–º–ø—Ç–∞

**–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞** (–∏—Å—á–µ–∑–∞–µ—Ç –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è):
- –°–æ–¥–µ—Ä–∂–∏—Ç –ø—É—Ç—å: `~/dotfiles/lazyvim`
- –°–æ–¥–µ—Ä–∂–∏—Ç git –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é: `(main)`
- –°–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ö–æ—Å—Ç: `user@hostname`

**–°—Ç—Ä–æ–∫–∞ —Å–∏–º–≤–æ–ª–∞** (–æ—Å—Ç–∞–µ—Ç—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π):
- –°–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ —Å–∏–º–≤–æ–ª –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è: `‚ùØ`
- –ö –Ω–µ–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤–≤–µ–¥–µ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞: `‚ùØ pwd`

## üéØ –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã

### –≠—Ç–∞–ø 1: –ó–∞–ø—É—Å–∫ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞
```
0: user@hostname ~/dotfiles/lazyvim (main)  ‚Üê –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
1: ‚ùØ                                        ‚Üê —Å—Ç—Ä–æ–∫–∞ —Å–∏–º–≤–æ–ª–∞
```

**–°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–ª–∞–≥–∏–Ω–∞:**
- `current_prompt_info.lines = [—Å—Ç—Ä–æ–∫–∞0, —Å—Ç—Ä–æ–∫–∞1]`
- `current_prompt_info.is_multiline = true`
- `state = STATES.WAITING_FOR_COMMAND`

### –≠—Ç–∞–ø 2: –í–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã + Enter
```
0: user@hostname ~/dotfiles/lazyvim (main)
1: ‚ùØ pwd                                    ‚Üê –∫–æ–º–∞–Ω–¥–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫ —Å–∏–º–≤–æ–ª—É
```

**–û–±—Ä–∞–±–æ—Ç–∫–∞ Enter (capture-lines.lua:278-358):**
```lua
-- –î–ª—è –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞: —É–±–∏—Ä–∞–µ–º —Å–∏–º–≤–æ–ª –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏
if state.current_prompt_info.is_multiline then
  local prompt_symbol = state.current_prompt_info.lines[2] -- "‚ùØ"
  local prompt_end = line:find(vim.pesc(prompt_symbol), 1, true)
  if prompt_end then
    line = line:sub(prompt_end + #prompt_symbol) -- –∏–∑–≤–ª–µ–∫–∞–µ–º "pwd"
  end
end

state.current_command = {
  text = "pwd",
  lines = {"pwd"},
  prompt_line = 0,
  enter_line = 1,
  output_start_line = 2,
}
```

### –≠—Ç–∞–ø 3: –í—ã–≤–æ–¥ –∫–æ–º–∞–Ω–¥—ã
```
0: user@hostname ~/dotfiles/lazyvim (main)
1: ‚ùØ pwd
2: /Users/romodanov.d/dotfiles/lazyvim      ‚Üê –Ω–∞–∫–∞–ø–ª–∏–≤–∞–µ—Ç—Å—è –≤ output_lines
```

### –≠—Ç–∞–ø 4: –ü–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏—Å—á–µ–∑–∞–µ—Ç)
```
0: ‚ùØ pwd                                    ‚Üê –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –∏—Å—á–µ–∑–ª–∞
1: /Users/romodanov.d/dotfiles/lazyvim
2: user@hostname ~/dotfiles/lazyvim (main)  ‚Üê –Ω–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞
3: ‚ùØ                                        ‚Üê –Ω–æ–≤—ã–π —Å–∏–º–≤–æ–ª –ø—Ä–æ–º–ø—Ç–∞
```

**–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é (capture-lines.lua:156-192):**
```lua
local output_lines = vim.api.nvim_buf_get_lines(
  bufnr,
  state.current_command.output_start_line - 1, -- —Å—Ç—Ä–æ–∫–∞ 1
  line_number - 1, -- –¥–æ —Å—Ç—Ä–æ–∫–∏ 2 (–Ω–µ –≤–∫–ª—é—á–∞—è –Ω–æ–≤—ã–π –ø—Ä–æ–º–ø—Ç)
  false
)

local entry = {
  command = "pwd",
  output = "/Users/romodanov.d/dotfiles/lazyvim", -- —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∞ 1
  prompt_line = 0,
  enter_line = 1,
  output_end_line = 1,
}
```

## üîÑ –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

1. **–ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏**: –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –∏—Å—á–µ–∑–∞–µ—Ç, –æ—Å—Ç–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å—Ç—Ä–æ–∫–∞ —Å —Å–∏–º–≤–æ–ª–æ–º –∏ –∫–æ–º–∞–Ω–¥–æ–π.

2. **–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã**: –ö–æ–º–∞–Ω–¥–∞ –∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –ø—É—Ç–µ–º —É–¥–∞–ª–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–∞ –ø—Ä–æ–º–ø—Ç–∞ –∏–∑ —Å—Ç—Ä–æ–∫–∏: `‚ùØ pwd` ‚Üí `pwd`

3. **–ì—Ä–∞–Ω–∏—Ü—ã –≤—ã–≤–æ–¥–∞**: –í—ã–≤–æ–¥ –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç—Å—è –æ—Ç `output_start_line` –¥–æ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ (–∏—Å–∫–ª—é—á–∞—è —Å–∞–º –ø—Ä–æ–º–ø—Ç).

4. **–î–µ—Ç–µ–∫—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞**: –ù–æ–≤—ã–π –º–Ω–æ–≥–æ—Å—Ç—Ä–æ—á–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–µ—Ç–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ –ø–æ—è–≤–ª–µ–Ω–∏—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ + —Å–∏–º–≤–æ–ª–∞ –ø—Ä–æ–º–ø—Ç–∞.

## üêõ –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –ø–æ—Ä—è–¥–∫–∞ —Å—Ç—Ä–æ–∫**: –ê–ª–≥–æ—Ä–∏—Ç–º –æ–∂–∏–¥–∞–µ—Ç, —á—Ç–æ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥—à–µ—Å—Ç–≤—É–µ—Ç —Å—Ç—Ä–æ–∫–µ —Å–∏–º–≤–æ–ª–∞.

2. **–°–ª–æ–∂–Ω–æ—Å—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤**: –ú–Ω–æ–∂–µ—Å—Ç–≤–æ —ç–≤—Ä–∏—Å—Ç–∏–∫ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –º–æ–∂–µ—Ç –¥–∞–≤–∞—Ç—å –ª–æ–∂–Ω—ã–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏—è.

3. **–ò—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫**: –õ–æ–≥–∏–∫–∞ –¥–æ–ª–∂–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ —Å—Ç—Ä–æ–∫–∏ –∏—Å—á–µ–∑–∞—é—Ç –∏–∑ –±—É—Ñ–µ—Ä–∞.

---

*–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: 2025-01-13*
*–í–µ—Ä—Å–∏—è –ø–ª–∞–≥–∏–Ω–∞: terminal-history v1.0*